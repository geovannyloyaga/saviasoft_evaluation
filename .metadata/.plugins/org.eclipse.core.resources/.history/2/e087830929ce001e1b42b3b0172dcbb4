package com.saviasoft.backend;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.transaction.PlatformTransactionManager;
import org.springframework.transaction.TransactionDefinition;
import org.springframework.transaction.TransactionStatus;
import org.springframework.transaction.support.DefaultTransactionDefinition;

import com.saviasoft.backend.apirest.dao.PersonDao;
import com.saviasoft.backend.apirest.dto.ResponseDto;
import com.saviasoft.backend.apirest.dto.ResponseListDto;
import com.saviasoft.backend.apirest.entities.Person;
import com.saviasoft.backend.apirest.interfaces.IPersonService;

public class PersonService implements IPersonService {

	@Autowired
	private PersonDao personDao;

	public void setArticleDao(PersonDao personDao) {
		this.personDao = personDao;
	}

	@Autowired
	private PlatformTransactionManager transactionManager;
	
	@Override
	public ResponseDto<Person> save(Person person) {
		Person personCreated = null;
		ResponseDto<Person> responseArticle = new ResponseDto<Person>(200, null, null);
		
		DefaultTransactionDefinition definirTransaccion = new DefaultTransactionDefinition();
		definirTransaccion.setReadOnly(Boolean.FALSE);
		definirTransaccion.setIsolationLevel(TransactionDefinition.ISOLATION_DEFAULT);
		TransactionStatus statusTransaction = this.transactionManager.getTransaction(definirTransaccion);
		
		try {
			personCreated = this.personDao.save(person);
			if (personCreated != null && personCreated.getId() != null) {
				responseArticle.setResponseObject(personCreated);
				this.transactionManager.commit(statusTransaction);
				responseArticle.setCode(200);
			} else {					
				this.transactionManager.rollback(statusTransaction);
				responseArticle.setCode(409);
				responseArticle.setError("Error al momento de crear la persona");
			}
			return responseArticle;
		} catch (Exception e) {
			this.transactionManager.rollback(statusTransaction);
			responseArticle.setCode(409);
			responseArticle.setError("Error al momento de crear la persona");
			return responseArticle;
		} finally {
			personCreated = null;
			responseArticle = null;
			definirTransaccion = null;
			statusTransaction = null;
		}
	}

	@Override
	public ResponseDto<Person> update(Person person) {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public ResponseDto<Person> delete(Person person) {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public ResponseListDto<Person> getPersonList() {
		// TODO Auto-generated method stub
		return null;
	}

}
